# Maqueen Plus I2C 통신 프로토콜 (lib_robot_maqueen.py 기반 분석)

이 문서는 `lib_robot_maqueen.py` Python 코드를 기반으로 분석한 Maqueen Plus 로봇의 I2C 통신 프로토콜을 설명합니다.

## 1. 기본 정보

*   **I2C 슬레이브 주소:** `0x10`

## 2. 제어 명령 및 데이터 형식

Micro:bit (마스터)가 Maqueen Plus (슬레이브)로 I2C 쓰기 작업을 수행할 때, 일반적으로 첫 번째 바이트는 제어할 대상이나 기능을 나타내는 **레지스터 주소 (명령 ID)** 이며, 이후 바이트는 해당 명령에 필요한 데이터입니다. 읽기 작업 시에는 먼저 읽고자 하는 데이터의 레지스터 주소를 쓴 다음, 읽기 작업을 수행합니다.

### 2.1 모터 제어

*   **함수:** `motorControl(mot, dir, spd)`
*   **I2C 쓰기:** `[레지스터 주소, 방향, 속도]` (총 3바이트)
    *   **좌측 모터:**
        *   레지스터 주소: `0x00`
        *   데이터: `[0x00, 방향, 속도]`
    *   **우측 모터:**
        *   레지스터 주소: `0x02`
        *   데이터: `[0x02, 방향, 속도]`
    *   **방향 (dir):**
        *   `1`: 정방향
        *   `2`: 역방향
    *   **속도 (spd):** `0` ~ `255`

### 2.2 서보 모터 제어

*   **함수:** `servo(num, angle)`
*   **I2C 쓰기:** `[레지스터 주소, 각도]` (총 2바이트)
    *   **서보 S1:**
        *   레지스터 주소: `0x14`
        *   데이터: `[0x14, 각도]`
    *   **서보 S2:**
        *   레지스터 주소: `0x15`
        *   데이터: `[0x15, 각도]`
    *   **서보 S3:**
        *   레지스터 주소: `0x16`
        *   데이터: `[0x16, 각도]`
    *   **각도 (angle):** `0` ~ `180` (도)

### 2.3 RGB LED 제어

*   **함수:** `RGBLight(rgbshow, color)`
*   **I2C 쓰기:**
    *   **좌측 RGB:** `[0x0B, 색상]` (총 2바이트)
    *   **우측 RGB:** `[0x0C, 색상]` (총 2바이트)
    *   **양쪽 RGB (동시):** `[0x0B, 색상, 색상]` (총 3바이트 - 코드 구현 방식)
    *   **색상 (color):**
        *   `1`: RED (빨강)
        *   `2`: GREEN (초록)
        *   `4`: BLUE (파랑)
        *   `3`: YELLOW (노랑)
        *   `5`: PINK (분홍)
        *   `6`: CYAN (청록)
        *   `7`: WHITE (흰색)
        *   `8`: OFF (끄기)

### 2.4 라인 트래킹 센서 읽기

*   **함수:** `getLine()`
*   **프로세스:**
    1.  **I2C 쓰기:** `[0x1D]` (1바이트) - 센서 값 읽기 요청
    2.  **I2C 읽기:** 1바이트 데이터 수신
*   **수신 데이터:** 1바이트 값. 각 비트는 특정 센서의 상태를 나타냅니다 (검은색 감지 시 해당 비트가 1).
    *   Bit 2 (0x04): L1
    *   Bit 1 (0x02): L2
    *   Bit 0 (0x01): L3
    *   Bit 3 (0x08): R1
    *   Bit 4 (0x10): R2
    *   Bit 5 (0x20): R3

### 2.5 엔코더 값 읽기

*   **함수:** `getEncoders()`
*   **프로세스:**
    1.  **I2C 쓰기:** `[0x04]` (1바이트) - 엔코더 값 읽기 요청
    2.  **I2C 읽기:** 4바이트 데이터 수신
*   **수신 데이터:** 4바이트. Big-Endian 형식의 16비트 정수 2개 (좌측 엔코더 카운트, 우측 엔코더 카운트).
    *   `[좌측 상위 바이트, 좌측 하위 바이트, 우측 상위 바이트, 우측 하위 바이트]`

### 2.6 엔코더 값 초기화

*   **함수:** `clearEncoders()`
*   **I2C 쓰기:** `[0x04, 0x00, 0x00, 0x00, 0x00]` (총 5바이트) - 엔코더 레지스터에 0 값을 씀

**참고:** 이 문서는 제공된 Python 코드 분석에 기반하며, 실제 Maqueen Plus 하드웨어의 공식 문서와 다소 차이가 있을 수 있습니다.
